<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditoria 5S - Lagotela | Moderno</title>
    
    <base href="/auditoria-5s-web/"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        /* ========================================
         CONFIGURAÇÕES BASE E VARIÁVEIS DE COR
         ========================================
        */
        :root {
            /* Cores Lagotela (Light Mode) */
            --primary-highlight: #E30712; /* Vermelho do Logo */
            --primary-teal: #008080; /* Teal/Ciano */
            --primary-dark: #004E4E; 
            --background-body: linear-gradient(135deg, #f0f8ff, #ddebf7); /* Fundo suave */
            
            /* Glassmorphism Base (Light) */
            --glass-background: rgba(255, 255, 255, 0.4); 
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);

            --text-color: #333;
            --text-secondary: #666;
        }

        /* ========================================
         TEMA DARK (Glassmorphism Escuro)
         ========================================
        */
        body.dark-mode {
            --primary-highlight: #FF4444; /* Vermelho mais vibrante no escuro */
            --primary-teal: #4BC0C0; 
            --primary-dark: #004E4E;
            --background-body: linear-gradient(135deg, #1f2833, #0a111a); 
            
            /* Glassmorphism Base (Dark) */
            --glass-background: rgba(30, 30, 30, 0.5); 
            --glass-border: rgba(60, 60, 60, 0.8);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);

            --text-color: #f0f0f0;
            --text-secondary: #aaaaaa;
        }
        
        /* ========================================
         ESTILOS BASE E CONTAINER GLASSMORPHISM
         ========================================
        */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--background-body); 
            color: var(--text-color);
            min-height: 100vh;
            transition: background 0.5s, color 0.3s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            border-radius: 15px;
            
            /* EFEITO GLASSMORPHISM */
            background: var(--glass-background);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            transition: background 0.3s, box-shadow 0.3s;
        }

        .header-top {
            display: flex;
            justify-content: center; /* Centraliza itens no cabeçalho */
            align-items: flex-start;
            margin-bottom: 35px;
            position: relative; /* Para posicionar o botão de tema */
        }

        .header-logo {
            text-align: center; /* Centraliza conteúdo (logo e texto) */
        }
        
        .logo-img {
            max-width: 100%; 
            max-height: 60px;
            height: auto;
            margin-bottom: 15px;
        }

        h1 {
            color: var(--primary-highlight); 
            text-align: center; 
            margin-top: 0;
            font-size: 1.8em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            color: var(--text-secondary);
            font-size: 1em;
            margin-bottom: 30px;
            font-weight: 400;
        }

        /* ========================================
         SEÇÕES 5S COM ÍCONES E VIDRO
         ========================================
        */
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .dark-mode .section {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-header {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.3em;
            color: var(--primary-teal); 
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-highlight);
        }
        
        .section-header i {
            font-size: 1.2em;
            margin-right: 15px;
            color: var(--primary-highlight); 
        }
        
        .question {
            margin-bottom: 18px;
            padding: 10px 0;
            border-bottom: 1px dotted var(--text-secondary);
            opacity: 0.9;
        }

        .question label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        /* ========================================
         ESTILOS DAS ESTRELINHAS (MAIS MODERNAS) 
         ========================================
        */
        .star-rating {
            display: flex;
            justify-content: flex-end; 
            flex-direction: row-reverse; 
            direction: rtl;
        }

        .star-rating input[type="radio"] {
            display: none;
        }

        .star-rating label {
            cursor: pointer;
            font-size: 2.2em; 
            padding: 0 5px;
            color: var(--text-secondary); 
            transition: color 0.2s, transform 0.2s;
            line-height: 1;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
        }

        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #ffd700; 
            transform: scale(1.1);
        }

        .star-rating input[type="radio"]:checked ~ label {
            color: #ffd700; 
            transform: scale(1.05);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); 
        }
        
        /* ========================================
         INPUTS E BOTÕES (Design Moderno/Glass)
         ========================================
        */
        .user-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .user-info input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
            background: var(--glass-background);
            color: var(--text-color);
            transition: border-color 0.3s, background 0.3s, box-shadow 0.3s;
        }
        
        .user-info input:focus {
            outline: none;
            border-color: var(--primary-highlight);
            box-shadow: 0 0 0 3px rgba(227, 7, 18, 0.3);
        }

        button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-teal); 
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 128, 128, 0.3);
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            margin-top: 20px;
        }
        
        button i {
            margin-right: 10px;
        }

        button:hover {
            background-color: var(--primary-dark); 
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 128, 128, 0.4);
        }

        /* Botões Secundários */
        #export-data {
            background-color: #5c6bc0; 
            box-shadow: 0 4px 10px rgba(92, 107, 192, 0.3);
        }

        #export-data:hover {
            background-color: #3f51b5;
        }
        
        #copy-button {
            background-color: #26a69a; 
            box-shadow: 0 4px 10px rgba(38, 166, 154, 0.3);
        }

        #copy-button:hover {
            background-color: #009688;
        }
        
        /* Botão do Dark Mode (Posicionado Absolutamente) */
        #theme-toggle {
            position: absolute; 
            left: 0; 
            top: 0; 
            width: auto;
            padding: 10px 15px;
            margin: 0;
            font-size: 0.9em;
            background-color: var(--glass-background);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
            box-shadow: none;
            transition: all 0.3s;
        }
        
        #theme-toggle:hover {
            background-color: rgba(227, 7, 18, 0.1); 
            transform: none;
            box-shadow: 0 0 5px rgba(227, 7, 18, 0.5);
        }


        /* ========================================
         ÁREA DE RESULTADOS E GRÁFICO
         ========================================
        */
        #results-area {
            margin-top: 40px;
            padding: 25px;
            border-radius: 12px;
            background: var(--glass-background);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            display: none; 
            text-align: center;
        }
        
        #results-area h3 {
            color: var(--primary-highlight);
            border-bottom: 2px solid var(--primary-teal);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #score-summary {
            font-size: 1.4em;
            margin-bottom: 25px;
            padding: 10px;
            border-radius: 8px;
            background-color: rgba(0, 128, 128, 0.1); 
        }
        
        .dark-mode #score-summary {
             background-color: rgba(75, 192, 192, 0.1); 
        }
        
        #chart-container {
            max-width: 450px;
            margin: 20px auto 30px auto;
            background-color: var(--glass-background); 
            padding: 10px;
            border-radius: 10px;
        }

        #export-output {
            margin-top: 25px;
            padding: 20px;
            border: 1px dashed var(--primary-highlight);
            background-color: rgba(227, 7, 18, 0.05); 
            white-space: pre-wrap;
            word-wrap: break-word;
            border-radius: 8px;
            font-size: 0.9em;
            display: none; 
            color: var(--text-color);
            font-weight: 500;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header-top">
        <button id="theme-toggle" onclick="toggleTheme()">
             <i class="fas fa-moon"></i> Dark Mode
        </button>
        
        <div class="header-logo">
            <img src="Lagotela40anos" 
                 alt="Logotipo Lagotela" 
                 class="logo-img">
                 
            <h1>Auditoria 5S</h1>
            <h2>Ferramenta de Avaliação Interna</h2>
        </div>
    </div>

    <div class="user-info">
        <input type="text" id="username" placeholder="Seu Nome/Usuário" required>
        <input type="text" id="sector" placeholder="Setor Avaliado" required>
    </div>

    <form id="audit-form">
        
        <div class="section">
            <div class="section-header">
                <i class="fas fa-tags"></i> 1 - SEIRI (UTILIZAÇÃO)
            </div>
            
            <div class="question">
                <label>Existem materiais ou equipamentos espalhados pelo setor?</label>
                <div class="star-rating">
                    <input type="radio" id="seiri-q1-5" name="seiri-q1" value="5" required><label for="seiri-q1-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiri-q1-4" name="seiri-q1" value="4"><label for="seiri-q1-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiri-q1-3" name="seiri-q1" value="3"><label for="seiri-q1-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiri-q1-2" name="seiri-q1" value="2"><label for="seiri-q1-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiri-q1-1" name="seiri-q1" value="1"><label for="seiri-q1-1" title="Péssimo (1)">★</label>
                </div>
            </div>

            <div class="question">
                <label>Existem itens quebrados ou obsoletos no setor?</label>
                <div class="star-rating">
                    <input type="radio" id="seiri-q2-5" name="seiri-q2" value="5" required><label for="seiri-q2-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiri-q2-4" name="seiri-q2" value="4"><label for="seiri-q2-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiri-q2-3" name="seiri-q2" value="3"><label for="seiri-q2-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiri-q2-2" name="seiri-q2" value="2"><label for="seiri-q2-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiri-q2-1" name="seiri-q2" value="1"><label for="seiri-q2-1" title="Péssimo (1)">★</label>
                </div>
            </div>
            
            <div class="question">
                <label>Itens necessários estão próximos de quem irá utilizar?</label>
                <div class="star-rating">
                    <input type="radio" id="seiri-q3-5" name="seiri-q3" value="5" required><label for="seiri-q3-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiri-q3-4" name="seiri-q3" value="4"><label for="seiri-q3-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiri-q3-3" name="seiri-q3" value="3"><label for="seiri-q3-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiri-q3-2" name="seiri-q3" value="2"><label for="seiri-q3-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiri-q3-1" name="seiri-q3" value="1"><label for="seiri-q3-1" title="Péssimo (1)">★</label>
                </div>
            </div>
            
            <div class="question">
                <label>O descarte de itens inutilizáveis está sendo feito corretamente?</label>
                <div class="star-rating">
                    <input type="radio" id="seiri-q4-5" name="seiri-q4" value="5" required><label for="seiri-q4-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiri-q4-4" name="seiri-q4" value="4"><label for="seiri-q4-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiri-q4-3" name="seiri-q4" value="3"><label for="seiri-q4-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiri-q4-2" name="seiri-q4" value="2"><label for="seiri-q4-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiri-q4-1" name="seiri-q4" value="1"><label for="seiri-q4-1" title="Péssimo (1)">★</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <i class="fas fa-folder-open"></i> 2 - SEITON (ORDENAÇÃO)
            </div>
            
            <div class="question">
                <label>Todos os itens necessários estão identificados (etiquetas/placas)?</label>
                <div class="star-rating">
                    <input type="radio" id="seiton-q1-5" name="seiton-q1" value="5" required><label for="seiton-q1-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiton-q1-4" name="seiton-q1" value="4"><label for="seiton-q1-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiton-q1-3" name="seiton-q1" value="3"><label for="seiton-q1-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiton-q1-2" name="seiton-q1" value="2"><label for="seiton-q1-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiton-q1-1" name="seiton-q1" value="1"><label for="seiton-q1-1" title="Péssimo (1)">★</label>
                </div>
            </div>

            <div class="question">
                <label>Existem locais definidos (demarcações/organização) para todos os itens?</label>
                <div class="star-rating">
                    <input type="radio" id="seiton-q2-5" name="seiton-q2" value="5" required><label for="seiton-q2-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiton-q2-4" name="seiton-q2" value="4"><label for="seiton-q2-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiton-q2-3" name="seiton-q2" value="3"><label for="seiton-q2-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiton-q2-2" name="seiton-q2" value="2"><label for="seiton-q2-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiton-q2-1" name="seiton-q2" value="1"><label for="seiton-q2-1" title="Péssimo (1)">★</label>
                </div>
            </div>
            
            <div class="question">
                <label>É fácil para qualquer pessoa encontrar o que precisa?</label>
                <div class="star-rating">
                    <input type="radio" id="seiton-q3-5" name="seiton-q3" value="5" required><label for="seiton-q3-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiton-q3-4" name="seiton-q3" value="4"><label for="seiton-q3-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiton-q3-3" name="seiton-q3" value="3"><label for="seiton-q3-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiton-q3-2" name="seiton-q3" value="2"><label for="seiton-q3-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiton-q3-1" name="seiton-q3" value="1"><label for="seiton-q3-1" title="Péssimo (1)">★</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <i class="fas fa-broom"></i> 3 - SEISO (LIMPEZA)
            </div>
            
            <div class="question">
                <label>O setor está livre de poeira, resíduos ou sujeira visível?</label>
                <div class="star-rating">
                    <input type="radio" id="seiso-q1-5" name="seiso-q1" value="5" required><label for="seiso-q1-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiso-q1-4" name="seiso-q1" value="4"><label for="seiso-q1-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiso-q1-3" name="seiso-q1" value="3"><label for="seiso-q1-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiso-q1-2" name="seiso-q1" value="2"><label for="seiso-q1-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiso-q1-1" name="seiso-q1" value="1"><label for="seiso-q1-1" title="Péssimo (1)">★</label>
                </div>
            </div>

            <div class="question">
                <label>Equipamentos e ferramentas estão limpos e bem conservados?</label>
                <div class="star-rating">
                    <input type="radio" id="seiso-q2-5" name="seiso-q2" value="5" required><label for="seiso-q2-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiso-q2-4" name="seiso-q2" value="4"><label for="seiso-q2-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiso-q2-3" name="seiso-q2" value="3"><label for="seiso-q2-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiso-q2-2" name="seiso-q2" value="2"><label for="seiso-q2-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiso-q2-1" name="seiso-q2" value="1"><label for="seiso-q2-1" title="Péssimo (1)">★</label>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <i class="fas fa-clipboard-check"></i> 4 - SEIKETSU (PADRONIZAÇÃO)
            </div>
            
            <div class="question">
                <label>Existem procedimentos de limpeza, organização e descarte visíveis e sendo seguidos?</label>
                <div class="star-rating">
                    <input type="radio" id="seiketsu-q1-5" name="seiketsu-q1" value="5" required><label for="seiketsu-q1-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiketsu-q1-4" name="seiketsu-q1" value="4"><label for="seiketsu-q1-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiketsu-q1-3" name="seiketsu-q1" value="3"><label for="seiketsu-q1-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiketsu-q1-2" name="seiketsu-q1" value="2"><label for="seiketsu-q1-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiketsu-q1-1" name="seiketsu-q1" value="1"><label for="seiketsu-q1-1" title="Péssimo (1)">★</label>
                </div>
            </div>

            <div class="question">
                <label>O ambiente de trabalho está sinalizado (segurança, rotas, etc.) de forma clara?</label>
                <div class="star-rating">
                    <input type="radio" id="seiketsu-q2-5" name="seiketsu-q2" value="5" required><label for="seiketsu-q2-5" title="Excelente (5)">★</label>
                    <input type="radio" id="seiketsu-q2-4" name="seiketsu-q2" value="4"><label for="seiketsu-q2-4" title="Bom (4)">★</label>
                    <input type="radio" id="seiketsu-q2-3" name="seiketsu-q2" value="3"><label for="seiketsu-q2-3" title="Regular (3)">★</label>
                    <input type="radio" id="seiketsu-q2-2" name="seiketsu-q2" value="2"><label for="seiketsu-q2-2" title="Ruim (2)">★</label>
                    <input type="radio" id="seiketsu-q2-1" name="seiketsu-q2" value="1"><label for="seiketsu-q2-1" title="Péssimo (1)">★</label>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <i class="fas fa-handshake"></i> 5 - SHITSUKE (DISCIPLINA)
            </div>
            
            <div class="question">
                <label>Os colaboradores demonstram seguir as regras e padrões de forma contínua?</label>
                <div class="star-rating">
                    <input type="radio" id="shitsuke-q1-5" name="shitsuke-q1" value="5" required><label for="shitsuke-q1-5" title="Excelente (5)">★</label>
                    <input type="radio" id="shitsuke-q1-4" name="shitsuke-q1" value="4"><label for="shitsuke-q1-4" title="Bom (4)">★</label>
                    <input type="radio" id="shitsuke-q1-3" name="shitsuke-q1" value="3"><label for="shitsuke-q1-3" title="Regular (3)">★</label>
                    <input type="radio" id="shitsuke-q1-2" name="shitsuke-q1" value="2"><label for="shitsuke-q1-2" title="Ruim (2)">★</label>
                    <input type="radio" id="shitsuke-q1-1" name="shitsuke-q1" value="1"><label for="shitsuke-q1-1" title="Péssimo (1)">★</label>
                </div>
            </div>

            <div class="question">
                <label>Há participação ativa dos colaboradores na manutenção do 5S?</label>
                <div class="star-rating">
                    <input type="radio" id="shitsuke-q2-5" name="shitsuke-q2" value="5" required><label for="shitsuke-q2-5" title="Excelente (5)">★</label>
                    <input type="radio" id="shitsuke-q2-4" name="shitsuke-q2" value="4"><label for="shitsuke-q2-4" title="Bom (4)">★</label>
                    <input type="radio" id="shitsuke-q2-3" name="shitsuke-q2" value="3"><label for="shitsuke-q2-3" title="Regular (3)">★</label>
                    <input type="radio" id="shitsuke-q2-2" name="shitsuke-q2" value="2"><label for="shitsuke-q2-2" title="Ruim (2)">★</label>
                    <input type="radio" id="shitsuke-q2-1" name="shitsuke-q2" value="1"><label for="shitsuke-q2-1" title="Péssimo (1)">★</label>
                </div>
            </div>
        </div>

        <button type="submit">
            <i class="fas fa-chart-pie"></i> Finalizar Auditoria e Gerar Resultados
        </button>
    </form>
    
    <div id="results-area">
        <h3><i class="fas fa-medal"></i> Resultados da Auditoria 5S</h3>
        <div id="score-summary"></div>
        
        <div id="chart-container">
            <canvas id="pieChart"></canvas>
        </div>
        
        <button id="export-data" onclick="exportData()">
            <i class="fas fa-file-csv"></i> Exportar Dados (CSV)
        </button>
        <button id="copy-button" onclick="copyToClipboard()">
            <i class="fas fa-copy"></i> Copiar Dados CSV
        </button>
        <div id="export-output"></div>
    </div>

</div>

<script>
    // Variável global para o gráfico
    let myPieChart = null;

    // === TEMA (DARK/LIGHT MODE) ===
    const body = document.body;
    const themeToggleBtn = document.getElementById('theme-toggle');

    function toggleTheme() {
        body.classList.toggle('dark-mode');
        
        const isDarkMode = body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        
        themeToggleBtn.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i> Light Mode' : '<i class="fas fa-moon"></i> Dark Mode';
        
        // Se o gráfico existir, redesenha para ajustar as cores do texto
        if (myPieChart) {
            drawChart(myPieChart.data.datasets[0].data, myPieChart.data.labels);
        }
    }

    // Carrega a preferência de tema ao carregar a página
    window.onload = function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
        } else {
             themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
        }
    };


    // === FUNÇÃO DO GRÁFICO (CHART.JS) ===
    function drawChart(dataScores, labels) {
        const ctx = document.getElementById('pieChart').getContext('2d');
        const rootStyles = getComputedStyle(document.documentElement);
        
        // Cores padrão definidas no CSS
        const colors = [
            rootStyles.getPropertyValue('--color-seiri'),
            rootStyles.getPropertyValue('--color-seiton'),
            rootStyles.getPropertyValue('--color-seiso'),
            rootStyles.getPropertyValue('--color-seiketsu'),
            rootStyles.getPropertyValue('--color-shitsuke')
        ];
        
        // Destruir o gráfico anterior se existir
        if (myPieChart) {
            myPieChart.destroy();
        }

        // Cor do texto/label no gráfico baseada no tema
        const textColor = getComputedStyle(body).getPropertyValue('color');
        
        myPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: dataScores,
                    backgroundColor: colors,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: textColor 
                        }
                    },
                    title: {
                        display: true,
                        text: 'Média de Pontuação por Senso (5S)',
                        color: textColor
                    }
                }
            }
        });
    }


    // === COLETA E EXPORTAÇÃO DE DADOS ===

    const form = document.getElementById('audit-form');
    const usernameInput = document.getElementById('username');
    const sectorInput = document.getElementById('sector');
    const resultsArea = document.getElementById('results-area');
    const scoreSummary = document.getElementById('score-summary');
    const outputDiv = document.getElementById('export-output');
    const copyButton = document.getElementById('copy-button');
    let lastExportData = '';

    form.addEventListener('submit', function(event) {
        event.preventDefault(); 

        if (!usernameInput.value || !sectorInput.value) {
            alert('Por favor, preencha seu Nome/Usuário e o Setor Avaliado.');
            return;
        }

        const formData = new FormData(form);
        const results = {
            'Data_Avaliacao': new Date().toLocaleString('pt-BR'),
            'Auditor_Usuario': usernameInput.value.replace(/;/g, ',').trim(), 
            'Setor': sectorInput.value.replace(/;/g, ',').trim() 
        };

        let totalQuestions = 0;
        let totalScore = 0;
        let questionsData = [];
        
        const sensoScores = { 'Seiri': {sum: 0, count: 0}, 'Seiton': {sum: 0, count: 0}, 'Seiso': {sum: 0, count: 0}, 'Seiketsu': {sum: 0, count: 0}, 'Shitsuke': {sum: 0, count: 0} };
        
        // Mapeamento das perguntas
        const questionMap = {
            'seiri-q1': 'Seiri: Materiais/Equipamentos Espalhados?',
            'seiri-q2': 'Seiri: Itens Quebrados/Obsoletos?',
            'seiri-q3': 'Seiri: Itens Próximos de Uso?',
            'seiri-q4': 'Seiri: Descarte Correto?',
            'seiton-q1': 'Seiton: Itens Identificados?',
            'seiton-q2': 'Seiton: Locais Definidos?',
            'seiton-q3': 'Seiton: Facilidade de Encontrar?',
            'seiso-q1': 'Seiso: Setor Livre de Sujeira?',
            'seiso-q2': 'Seiso: Equipamentos Limpos/Conservados?',
            'seiketsu-q1': 'Seiketsu: Procedimentos Visíveis/Seguidos?',
            'seiketsu-q2': 'Seiketsu: Sinalização Clara?',
            'shitsuke-q1': 'Shitsuke: Colaboradores Seguem Regras?',
            'shitsuke-q2': 'Shitsuke: Participação Ativa?',
        };

        // Coleta os valores e calcula a média por senso
        let allAnswered = true;
        for (const [key, value] of formData.entries()) {
            if (key in questionMap) {
                const score = parseInt(value);
                
                if (isNaN(score)) {
                    allAnswered = false;
                    break;
                }
                
                const sensoName = key.split('-')[0].charAt(0).toUpperCase() + key.split('-')[0].slice(1);
                
                sensoScores[sensoName].sum += score;
                sensoScores[sensoName].count++;
                
                results[questionMap[key]] = score;
                totalScore += score;
                totalQuestions++;
                
                questionsData.push({
                    key: questionMap[key],
                    score: score
                });
            }
        }
        
        if (!allAnswered || questionsData.length !== Object.keys(questionMap).length) {
            alert('Por favor, preencha todos os campos da auditoria antes de gerar os resultados.');
            return;
        }


        const averageScore = totalQuestions > 0 ? (totalScore / totalQuestions).toFixed(2) : 0;
        const averagePercentage = totalQuestions > 0 ? ((averageScore / 5) * 100).toFixed(2) : 0;

        results.Media_Pontuacao_5S = averageScore;
        results.Media_Percentual_5S = averagePercentage + '%';
        
        // 1. Cálculo das médias por Senso para o Gráfico
        const chartLabels = [];
        const chartData = [];
        
        for (const senso in sensoScores) {
            if (sensoScores[senso].count > 0) {
                const sensoAvg = (sensoScores[senso].sum / sensoScores[senso].count).toFixed(2);
                chartLabels.push(`${senso} (${sensoAvg}/5)`);
                chartData.push(parseFloat(sensoAvg));
            }
        }
        
        // 2. Desenhar o Gráfico de Pizza
        drawChart(chartData, chartLabels);
        
        // 3. Exibir a Média Geral e a Área de Resultados
        scoreSummary.innerHTML = `
            <i class="fas fa-map-marked-alt"></i> Setor: <strong>${results.Setor}</strong><br>
            <i class="fas fa-star"></i> Média Geral 5S: <strong>${results.Media_Pontuacao_5S}/5</strong> (${results.Media_Percentual_5S})
        `;
        resultsArea.style.display = 'block';
        outputDiv.style.display = 'none'; 
        
        // 4. Geração do CSV 
        let csvHeader = [
            'Data_Avaliacao',
            'Auditor_Usuario',
            'Setor'
        ].concat(questionsData.map(d => d.key)).concat([
            'Media_Pontuacao_5S',
            'Media_Percentual_5S'
        ]).join(';');

        let csvRowData = [
            results.Data_Avaliacao,
            results.Auditor_Usuario,
            results.Setor
        ].concat(questionsData.map(d => d.score)).concat([
            results.Media_Pontuacao_5S,
            results.Media_Percentual_5S
        ]);
        
        let csvRow = csvRowData.map(v => `"${v}"`).join(';'); 
        lastExportData = csvHeader + '\n' + csvRow;
        
        alert(`Auditoria finalizada com sucesso!\nMédia: ${averageScore}/5 (${averagePercentage}%)`);

        // Rola a tela para a área de resultados
        resultsArea.scrollIntoView({ behavior: 'smooth' });
    });

    function exportData() {
        if (!lastExportData) {
            alert('Nenhuma avaliação foi finalizada para exportar.');
            return;
        }
        
        // Exibir os dados CSV
        outputDiv.innerText = "Dados no formato CSV (Copie o texto abaixo e cole em uma planilha):\n\n" + lastExportData;
        outputDiv.style.display = 'block';
        
        // Rola a tela para os dados de exportação
        outputDiv.scrollIntoView({ behavior: 'smooth' });
    }
    
    function copyToClipboard() {
        if (!lastExportData) {
            alert('Não há dados para copiar.');
            return;
        }
        
        navigator.clipboard.writeText(lastExportData)
            .then(() => {
                alert('Dados CSV copiados para a área de transferência!');
            })
            .catch(err => {
                console.error('Erro ao copiar: ', err);
                alert('Erro ao copiar. Tente selecionar e copiar o texto manualmente na caixa de dados.');
            });
    }

</script>

</body>
</html>